<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>診所行事曆 - Clinext</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','PingFang TC','Microsoft JhengHei',sans-serif;background:#f3f4f6}
    .legend-dot{width:10px;height:10px;border-radius:9999px}

    /* Mobile Font Adjustments */
    @media (max-width: 768px) {
        /* Scale down standard Tailwind text sizes */
        .text-lg { font-size: 1rem !important; }
        .text-sm { font-size: 0.75rem !important; }
        .text-base { font-size: 0.875rem !important; }

        /* FullCalendar Mobile Overrides */
        .fc .fc-toolbar-title {
            font-size: 1rem !important;
        }
        .fc .fc-button {
            font-size: 0.75rem !important;
            padding: 0.25rem 0.5rem !important;
        }
        .fc .fc-col-header-cell-cushion { /* Weekday headers */
            font-size: 0.75rem !important;
        }
        .fc .fc-daygrid-day-number { /* Date numbers */
            font-size: 0.75rem !important;
            padding: 2px !important;
        }
        .fc .fc-event {
            font-size: 0.7rem !important;
        }
        .fc .fc-toolbar {
            flex-wrap: wrap;
            gap: 0.5rem;
        }
    }
  </style>
</head>
<body>
  <div class="bg-gradient-to-r from-green-600 to-green-700 text-white px-4 py-3 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <a href="./staff/dashboard.html" class="text-white/80 hover:text-white transition-colors">
        <i class="fas fa-arrow-left text-lg"></i>
      </a>
      <div class="h-8 w-8 bg-white/20 rounded-lg flex items-center justify-center">
        <i class="fas fa-calendar-alt text-white"></i>
      </div>
      <span class="font-bold text-lg">Clinext 診所行事曆</span>
    </div>
    <div class="flex items-center gap-2">
      <a href="./sales/new_order.html" class="bg-white text-green-700 hover:bg-gray-100 px-3 py-1.5 rounded-full text-sm font-medium flex items-center gap-2">
        <i class="fas fa-plus"></i>
        新預約
      </a>
    </div>
  </div>
  <div class="px-4 py-4 space-y-4">
    <div class="bg-white rounded-xl shadow p-3 flex items-center justify-between">
      <div class="flex items-center gap-4 text-sm">
        <div class="flex items-center gap-2">
          <span class="legend-dot bg-blue-500"></span>
          <span>Botox</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="legend-dot bg-pink-500"></span>
          <span>Laser</span>
        </div>
        <div class="flex items-center gap-2">
          <span class="legend-dot bg-green-500"></span>
          <span>Facial</span>
        </div>
      </div>
      <div class="text-xs text-gray-500">拖曳以重新安排時間</div>
    </div>
    <div class="bg-white rounded-xl shadow p-3">
      <div id="clinicCalendar"></div>
    </div>
  </div>
  <script>
    function getDefaultAppointments(){
      const today=new Date();const y=today.getFullYear();const m=today.getMonth()+1;const d=today.getDate();
      function dt(yy,mm,dd,hh,mm2){const s=new Date(yy,mm-1,dd,hh,mm2);return s.toISOString().slice(0,16);}
      return [
        {id:'A1',title:'陳美玲｜Botox 30U',start:dt(y,m,d+1,10,0),end:dt(y,m,d+1,10,30),color:'#3b82f6',extendedProps:{type:'botox'}},
        {id:'A2',title:'林志明｜Pico Laser',start:dt(y,m,d+1,11,0),end:dt(y,m,d+1,11,45),color:'#ec4899',extendedProps:{type:'laser'}},
        {id:'A3',title:'王小美｜Facial 保養',start:dt(y,m,d+2,14,0),end:dt(y,m,d+2,15,0),color:'#10b981',extendedProps:{type:'facial'}}
      ];
    }
    function loadAppointments(){
      const raw=localStorage.getItem('clinext_appointments');if(!raw){const def=getDefaultAppointments();localStorage.setItem('clinext_appointments',JSON.stringify(def));return def;}
      try{const parsed=JSON.parse(raw);return Array.isArray(parsed)?parsed:getDefaultAppointments();}catch(e){return getDefaultAppointments();}
    }
    function saveAppointments(evts){localStorage.setItem('clinext_appointments',JSON.stringify(evts));}
    const calendarEl=document.getElementById('clinicCalendar');
    const initialEvents=loadAppointments();
    const calendar=new FullCalendar.Calendar(calendarEl,{
      height: 'auto',
      initialView:'dayGridMonth',
      headerToolbar:{left:'prev,next today',center:'title',right:'dayGridMonth,timeGridWeek,timeGridDay'},
      nowIndicator:true,
      selectable:true,
      editable:true,
      eventOverlap:false,
      events:initialEvents,
      eventDrop:function(info){
        const events=calendar.getEvents().map(e=>({id:e.id,title:e.title,start:e.startStr,end:e.endStr,color:e.backgroundColor||e.color,extendedProps:e.extendedProps}));
        saveAppointments(events);
      },
      eventResize:function(info){
        const events=calendar.getEvents().map(e=>({id:e.id,title:e.title,start:e.startStr,end:e.endStr,color:e.backgroundColor||e.color,extendedProps:e.extendedProps}));
        saveAppointments(events);
      },
      dateClick:function(arg){
        const ok=confirm('在此日期建立新預約？');if(!ok)return;
        const types=[{label:'Botox',color:'#3b82f6',type:'botox'},{label:'Laser',color:'#ec4899',type:'laser'},{label:'Facial',color:'#10b981',type:'facial'}];
        const sel=prompt('輸入類型: Botox / Laser / Facial','Botox');const t=types.find(x=>x.label.toLowerCase()===String(sel||'').toLowerCase());const name=prompt('患者姓名','新患者');
        if(!t||!name)return;
        const id='A'+Date.now();
        const start=new Date(arg.date);const end=new Date(arg.date);end.setHours(end.getHours()+1);
        const evt={id,title:`${name}｜${t.label}`,start:start.toISOString().slice(0,16),end:end.toISOString().slice(0,16),color:t.color,extendedProps:{type:t.type}};
        calendar.addEvent(evt);
        const events=calendar.getEvents().map(e=>({id:e.id,title:e.title,start:e.startStr,end:e.endStr,color:e.backgroundColor||e.color,extendedProps:e.extendedProps}));
        saveAppointments(events);
      },
      eventClick:function(info){
        const go=confirm('前往療程單頁面？');if(go)window.location.href='./sales/treatment_order.html';
      }
    });
    calendar.render();
  </script>
</body>
</html>
